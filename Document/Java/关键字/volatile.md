# volatile关键字

### 简介

> 在Java中,`volatile`是一个关键字,它用于声明一个变量是"易变的",也就是说它的值可能会被多个线程同时修改.`volatile`的作用是告诉Java虚拟机（JVM）和编译器,该变量可能会被并发线程访问和修改,因此不要对其进行某些优化,例如缓存该变量的值.



## 可见性(Visibility)

`volatile`保证了变量的可见性.

当一个线程修改了`volatile`变量的值时,这个新值会立即被写入到主内存中,而其他线程读取这个变量时会直接从主内存中读取最新值,而不是从线程的本地缓存中读取.这样就可以确保当一个线程修改了变量值后,其他线程能够立即看到最新值,从而避免了线程间的数据不一致问题



## 禁止指令重排序(Preventing Instruction Reordering)

`volatile`关键字还可以禁止编译器和处理器对被标记的变量进行重排序优化.

在多线程环境中,由于编译器和处理器的优化,可能会导致代码的执行顺序被重排序,这可能会影响到程序的正确性.使用`volatile`关键字可以确保被标记的变量不会被重排序,从而避免了这种问题.



## 缺点

虽然`volatile`能够保证可见性和禁止指令重排序,但是它并不能保证原子性.如果多个线程同时对一个`volatile`变量进行写操作,仍然可能会出现线程安全问题.

要想保证原子性,需要使用锁(`Lock` `synchronized`)或者原子类(`AtomicInteger` `AtomicLong`)等来确保操作的原子性
