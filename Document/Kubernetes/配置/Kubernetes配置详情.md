# Kubernetes配置



## apiVersion

> 用于指定使用的Kubernetes API版本

## kind

> 用于指定资源对象类型

| 类型             | 说明                                                         |
| ---------------- | ------------------------------------------------------------ |
| `Deployment`     | 用于声明式地管理应用程序的部署，可以自动创建、更新和扩展副本集，一般用于创建无状态应用 |
| `StatefulSet`    | 用于部署有状态应用程序，它为每个Pod提供唯一的标识符，并确保它们按顺序启动和终止 |
| `Service`        | 用于定义一组Pod的网络端点，为应用程序提供一个稳定的DNS名称和负载均衡 |
| `ConfigMap`      | 用于存储配置数据，如环境变量、配置文件或其他配置信息，以供Pod中的容器使用 |
| `DaemonSet`      | 用于确保在每个节点上运行一个Pod的实例，通常用于运行节点级别的守护进程，如监控代理或日志收集器 |
| `Job`            | 用于运行一次性任务，确保任务成功完成，它适用于需要一次性执行的任务，如批处理作业 |
| `CronJob`        | 用于周期性运行任务，类似于传统的cron作业，它可以按照预定的时间表运行Job |
| `Secret`         | Secret用于存储敏感数据，如密码、API密钥和证书等，它可以安全地传递给Pod中的容器，并用于安全地存储敏感信息 |
| `Ingress`        | Ingress用于公开集群中的服务，并配置HTTP和HTTPS路由规则，以便外部流量可以访问集群内的服务 |
| `Namespace`      | 用于将集群划分为多个逻辑部分，以便不同应用程序或团队可以在同一集群中隔离运行 |
| `Volume`         | 用于将存储附加到Pod中，以便容器可以访问持久数据或共享数据    |
| `ServiceAccount` | 用于为Pod提供身份，以便它们可以与Kubernetes API进行交互和授权访问其他资源 |

## metadata

> 用于定义`Pod`的元数据信息

## namespace

> Pod所属命名空间

## labels

> Pod的标签，键值对格式

## annotations

> Pod的注解，键值对格式

## spec

> 用于定义资源对象的规范或规格的部分

## replicas

> 定义副本的数量

## selector

> 标签选择器

## matchLabels

> 完全标签匹配

## matchExpressions

> 表达式匹配

## template

> 定义要在每个节点上运行的Pod的模板

## volumes

> 用于定义 `Pod`中的存储卷配置，存储卷是用于在容器之间共享和存储数据的抽象概念，它们允许容器在其生命周期内访问持久数据，而不受容器的生命周期限制

## initContainers

> 用于定义在容器启动之前运行的初始化容器
>
> 初始化容器是一种轻量级容器，它的主要目的是在主应用容器启动之前执行一些初始化任务，如数据准备、配置检查、数据库迁移等
>
> 一旦初始化容器的任务完成，主应用容器才会启动

## containers

> 用于定义 Pod 内的容器实例，容器是`Docker`镜像的实例，它包含了运行在`Pod`中的应用程序或进程
>
> 一个`Pod`可以包含一个或多个容器，这些容器可以协同工作来完成应用程序的不同部分或功能

## image

> 用于指定容器或初始化容器要使用的容器镜像的名称

## ports

> 用于定义容器中应用程序的端口配置

## protocol

> 用于定义容器的端口协议

| 类型            | 说明                          |
| --------------- | ----------------------------- |
| `TCP (default)` | 表示使用 TCP 协议进行网络通信 |
| `UDP`           | 表示使用 UDP 协议进行网络通信 |

## command

> 用于定义容器启动时要执行的命令

## args

> 用于指定容器或初始化容器的启动参数

## env

> 用于定义容器或初始化容器的环境变量

## envFrom

> 用于从其他`Kubernetes`资源（例如`ConfigMap`或`Secret`）中导入环境变量，然后将这些环境变量注入到容器中
>
> 这使得容器能够访问配置或敏感数据，而无需直接在`Pod`配置中硬编码这些值

## imagePullPolicy

> 用于定义容器在启动时如何获取容器镜像的策略

| 类型                     | 说明                                                         |
| ------------------------ | ------------------------------------------------------------ |
| `IfNotPresent (default)` | 优先使用本地镜像，只有当镜像在本地不存在时才会拉取           |
| `Always`                 | 始终拉取最新版本的镜像，即使本地已经存在镜像，也会尝试拉取最新版本 |
| `Never`                  | 仅使用本地镜像，如果镜像不存在于本地，则会启动失败           |

## workingDir

> 用于指定容器启动时的工作目录（Working Directory），工作目录是容器在启动后默认的当前工作目录，也就是容器内部的当前目录

## resources

> 用于配置容器的资源需求和限制。资源配置允许你明确指定容器在运行时所需的计算资源，如`CPU`和`内存`
>
> 这有助于 Kubernetes 集群进行资源分配和管理，确保容器能够在正确的条件下运行

## requests

> 用于定义容器的资源需求，即容器运行所需的最小资源量

## limits

> 用于定义容器的资源限制，即容器允许使用的资源的最大量

## livenessProbe

> 用于检查容器是否在运行时保持存活状态
>
> 如果`livenessProbe`失败，Kubernetes 将终止容器，并在需要时重新启动它
>
> 用于检测容器是否继续运行，如果容器因某种原因陷入无法恢复的错误状态，它将被终止

## readinessProbe

> 用于检查容器是否准备好接受流量
>
> 如果`readinessProbe` 失败，容器将被认为不准备接受流量，并将从`Service`的负载均衡中排除
>
> 通常用于确保容器已完成初始化、已经连接到依赖的服务或资源，并准备好处理请求

## startupProbe

> 用于检查容器是否已成功启动并准备好接受流量
>
> 它通常用于在容器启动之后，确保应用程序已完成初始化和准备好处理请求之前，不将流量引导到容器
>
> 如果`startupProbe`失败，Pod 将被认为是启动失败并将被重新启动
>
> 仅在容器启动时运行一次

## initialDelaySeconds

> 探测延迟时间

## successThreshold

> 探测成功次数上限

## failuerThreshold

> 探测失败次数上限

## periodSeconds

> 探测间隔时间

## timeoutSeconds

> 探测超时时间

## volumeMounts

> 用于将存储卷（Volume）挂载到容器内部的指定路径，这允许容器访问存储卷中的数据，以便进行读取或写入操作

## restartPolicy

> 用于定义容器的重启策略

| 类型               | 说明                                                         |
| :----------------- | ------------------------------------------------------------ |
| `Always (default)` | 如果容器终止，无论是正常退出还是出现错误，Kubernetes 都会自动将容器重新启动 |
| `OnFailure`        | 只有当容器终止状态为非零（即出现错误）时，Kubernetes 才会自动将容器重新启动，如果容器正常退出（退出状态为零），它将不会被自动重新启动 |
| `no`               | 容器不会自动重启                                             |

## strategy

> 用于定义滚动更新策略

## strategy.type

> 用于指定在应用程序升级期间使用哪种策略来替代旧的`Pods`

| 类型            | 说明                                                         |
| --------------- | ------------------------------------------------------------ |
| `RollingUpdate` | 滚动更新，这是最常见的滚动更新策略，在滚动更新期间，旧的`Pods`会被逐渐替代为新的`Pods`，从而保持应用程序的可用性，滚动更新策略通常与`strategy.rollingUpdate`配置一起使用，以指定`maxUnavailable`和`maxSurge`，控制替代和新增`Pods`的速度 |
| `Recreate`      | 在重新创建策略下，旧的`Pods`会被一次性销毁，然后新的`Pods`会被创建，这意味着在更新期间应用程序可能会出现一段时间的不可用性，因为旧`Pods`和新Pods`不能`同时运行 |

## maxUnavailable

> 用于指定在滚动更新期间允许的不可用`Pod`的最大数量

## maxSurge

> 用于指定在滚动更新期间允许额外的`Pod`的最大数量

## revisionHistoryLimit

> `Kubernetes`中用于控制`Deployment`控制器的历史修订记录数量
>
> `Deployment`控制器负责管理应用程序的滚动更新，它会维护历史修订记录，以便在需要时回滚到以前的版本

## volumeClaimTemplates

> `volumeClaimTemplates` 是 StatefulSet 配置中的一个字段，用于定义持久存储卷声明（Persistent Volume Claims，PVC）的模板
>
> 这允许每个 StatefulSet 中的 Pod 创建自己的持久存储卷，并确保这些存储卷在 Pod 重新启动或重新调度时不会丢失

## accessModes

> 用于定义PVC 的访问模式，通常可以是 "ReadWriteOnce"、"ReadOnlyMany" 或 "ReadWriteMany"。这决定了 PVC 是否可以被单个 Pod 以读写、只读或多次读写模式挂载

| 模式            | 说明       |
| --------------- | ---------- |
| `ReadWriteOnce` | 单节点读写 |
| `ReadOnlyMany`  | 多节点只读 |
| `ReadWriteMany` | 多节点读写 |

## podManagementPolicy

> `podManagementPolicy` 是 StatefulSet 配置中的一个字段，用于定义 StatefulSet 如何管理其 Pod
>
> 这个字段控制 StatefulSet 在何时创建、更新和删除 Pod

| 模式                    | 说明                                                         |
| ----------------------- | ------------------------------------------------------------ |
| `OrderedReady(default)` | 在`OrderedReady`模式下，`StatefulSet`确保`Pod`按照索引的顺序逐个启动，每个`Pod`在前一个`Pod`就绪后才会启动 |
| `Parallel`              | 在`Parallel`模式下，`StatefulSet`允许多个`Pod`并行启动       |

## updateStrategy

> `updateStrategy` 是 StatefulSet 配置中的一个字段，用于定义 StatefulSet 中的 Pod 如何进行更新（例如滚动更新或扩展）的策略

## updateStrategy.type

> 用于指定更新策略的类型

| 策略                     | 说明                                                         |
| ------------------------ | ------------------------------------------------------------ |
| `RollingUpdate(default)` | 这是默认的策略，它会逐个替换旧的`Pod`为新的`Pod`，这有助于确保有状态应用程序的有序更新，以防止数据中断或数据同步问题 |
| `OnDelete`               | 在这个策略下，`StatefulSet`不会主动替换旧的`Pod`，而是等待旧的`Pod`手动删除后再创建新的`Pod` |

## partition

> 这是一个整数字段，用于指定要更新的分区号，f只有具有分区号小于`partition`的`Pod`才会被更新
>
> 这可用于实现滚动更新的有序性，以避免同时替换所有`Pod`

## spec.type

> 用于定义服务的类型，以指定服务如何公开和访问

| 类型             | 说明                                                         |
| ---------------- | ------------------------------------------------------------ |
| ClusterIP        | 用于将服务公开到集群内部，允许其他`Pod`通过`ClusterIP`进行访问，通常用于内部服务通信，而不对外部暴露 |
| NodePort         | 用于将服务公开到集群节点上的指定端口上，以便集群外部的请求可以访问该端口 |
| LoadBalancer     | 用于将服务公开到集群外部，并通过云提供商的负载均衡器服务将流量分发到集群中的服务 |
| ExternalName     | 用于将服务名称映射到外部`DNS`名称，不提供负载均衡或流量路由功能，而仅仅是一个`DNS CNAME`记录，用于将服务名称解析为外部域名或IP地址 |
| Headless Service | 不为`Service`分配`ClusterIP`，不提供负载均衡或流量路由功能，直接公开与`Service`所选择的标签匹配的后端`Pod`的`IP`地址，这使得每个后端 `Pod`都有其唯一的`DNS`记录 |

## clusterIP

> 用于指定`Service`的`ClusterIP`地址
>
> `ClusterIP`是一个虚拟IP地址，用于在`Kubernetes`集群内部提供服务
>
> 它允许其他`Pod`和服务使用这个虚拟IP地址来访问Service，而不必了解`Service`后端`Pod`的实际IP地址

## externalName

> 用于将服务映射到外部域名
>
> 与普通的`Service`不同，`externalName Service`不会公开任何Pod，也不会使用`ClusterIP`或`NodePort`
>
> 相反，它将`Service`映射到一个外部域名，使集群内的应用程序可以使用该域名来访问外部服务，而不必了解外部服务的实际地址
>
> 通常与 `spec.type`设置为`LoadBalancer`类型的`Service`结合使用

## loadBalancerIP

> 用于指定为`LoadBalancer`类型的服务分配的外部负载均衡器的IP地址
>
> 它允许你明确指定所创建的负载均衡器的IP地址，而不是由云提供商或负载均衡器控制器自动分配
>
> 通常与 `spec.type`设置为`LoadBalancer`类型的`Service`结合使用

## loadBalancerSourceRanges

> 用于定义允许访问`LoadBalancer`类型服务的源IP范围，这可以用于限制来自特定IP地址范围的流量可以访问服务，增强服务的安全性

## sessionAffinity

> 用于控制客户端与后端`Pod`之间的会话关联性。它影响客户端请求如何分布到后端`Pod`，并在负载均衡时考虑会话状态

| 类型            | 说明                                                         |
| --------------- | ------------------------------------------------------------ |
| `None(default)` | 负载均衡器将根据负载均衡算法（通常是轮询或最小连接数）将客户端请求分发给后端Pod，不会考虑会话状态，每个请求都可能被路由到不同的Pod |
| `ClientIP`      | 负载均衡器将尝试维护客户端与特定后端Pod之间的会话关联性，它将基于客户端的IP地址将请求路由到相同的后端Pod，以确保来自同一客户端的请求都被发送到相同的Pod |

## externalTrafficPolicy

> 用于指定外部流量如何进入`ClusterIP`类型的服务的后端`Pod`
>
> 这个字段通常用于控制外部流量的行为，以确保请求不会绕过负载均衡器

| 类型               | 说明                                                         |
| ------------------ | ------------------------------------------------------------ |
| `cluster(default)` | 外部流量将进入 ClusterIP 类型服务的负载均衡器，并由负载均衡器根据服务的负载均衡策略将请求路由到后端Pod |
| `Local`            | 外部流量将进入集群，并首先路由到与外部请求的源IP地址最近的节点上，然后该节点上的负载均衡器将决定将请求路由到哪个后端 Pod，这有助于降低负载均衡器的负担，但可能会导致流量偏向于某些节点 |

## publishNotReadyAddresses

> 用于控制服务是否应该公开不处于就绪状态的后端`Pod`的网络地址

## sessionAffinityConfig

> 用于配置客户端IP会话关联性的行为。该字段通常用于定义客户端IP的会话保持策略
>
> 通常与 `sessionAffinity`设置为`ClientIP`时一起使用

## secret.type

> 
